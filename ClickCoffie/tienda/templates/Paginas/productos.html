{% extends 'Paginas/base.html' %}
{% load static %}

{% block title %}Productos{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/inicio.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />

{% endblock %}
{% block content %}
<div class="imagen-con-texto">
    <img src="{% static 'imgs/fondoinicio.png' %}" alt="Banner de café">
    <div class="texto-superpuesto">
        <h2>Aqui puedes escoger tus productos</h2>
    </div>
</div>
<div class="container">

    <div class="container-pro">
        {% for i in Inventario %}
        <div class="producto"data-stock="{{ i.CantidadActual }}">
            <img src="{% if i.Imagen %}{{ i.Imagen.url }}{% else %}{% static 'imgs/default.png' %}{% endif %}"
                alt="{{ i.Nombre }}" style="background-color: aliceblue;">
            <div class="info">
                <h3>{{ i.Nombre }}</h3>
                {% if i.Descripcion %}<p>{{ i.Descripcion }}</p>{% endif %}
                <span class="precio">${{ i.Precio }}</span>
            </div>
            <div class="acciones">
                <i class="disminuir fa-solid fa-minus"></i>
                <span class="cantidad">1</span>
                <i class="aumentar fa-solid fa-plus"></i>
            </div>
            {% if not user.is_authenticated %}
                 <a class="add-cart" href="{% url 'login' %}">Agregar al carrito</a>
            {% else %}
        <form action="{% url 'agregar_al_carrito' i.idProducto %}" method="POST">
            {% csrf_token %}
                <input type="hidden" name="cantidad" value="1" class="cantidad-input">
                <button type="submit" class="add-cart">Agregar al carrito</button>
        </form>
{% endif %}

        </div>


        {% endfor %}
    </div>
</div>
<script> document.querySelectorAll('.producto').forEach(producto => { const disminuir = producto.querySelector('.disminuir'); const aumentar = producto.querySelector('.aumentar'); const cantidad = producto.querySelector('.cantidad'); let count = 1; disminuir.addEventListener('click', () => { if(count > 1) count--; cantidad.textContent = count; }); aumentar.addEventListener('click', () => { count++; cantidad.textContent = count; }); }); </script>

{% block extra_js %}
<script src="{% static 'js/producto.js' %}"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var productos = document.querySelectorAll('.producto');

    productos.forEach(function(producto) {
        var disminuir = producto.querySelector('.disminuir');
        var aumentar = producto.querySelector('.aumentar');
        var cantidadSpan = producto.querySelector('.cantidad');
        var cantidadInput = producto.querySelector('.cantidad-input');

        var stock = parseInt(producto.dataset.stock); // stock disponible
        var count = 1;

        var botonAgregar = producto.querySelector('.add-cart');

        // Deshabilitar botón si stock = 0
        if (stock <= 0 && botonAgregar) {
            botonAgregar.disabled = true;
            botonAgregar.textContent = 'Agotado';
            aumentar.disabled = true; // También deshabilitar +
        }

        // Inicialmente si solo hay 1 unidad, mantener habilitado/disminuir
        if (stock <= 1) {
            aumentar.disabled = stock <= 1;
        }

        disminuir.addEventListener('click', function() {
            if (count > 1) {
                count--;
                cantidadSpan.textContent = count;
                cantidadInput.value = count;
                aumentar.disabled = false; // Rehabilitar botón + al disminuir
            }
        });

        aumentar.addEventListener('click', function() {
            if (count < stock) {
                count++;
                cantidadSpan.textContent = count;
                cantidadInput.value = count;

                if (count >= stock) {
                    aumentar.disabled = true; // Deshabilitar + al llegar al stock máximo
                }
            }
        });
    });
});
</script>
{% endblock %}

    
{% endblock %}